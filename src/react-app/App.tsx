import { useState } from "react";

// две строки на ключ: [0] — группа A, [1] — группа B
const vowTemplates: Record<string, [string, string]> = {
  "Безопасность и забота|Слова поддержки": [
    "Я вижу твою хранимую теплоту и словами укрываю её, чтобы ты смело раскрылась рядом со мной.",
    "Сохраним наше чувство в этой фразе-обереге — пусть напоминает о доме даже через годы."
  ],
  "Безопасность и забота|Время вместе": [
    "Я чувствую, как рядом с тобой я дышу глубже; подарю тебе время, где можешь быть настоящей.",
    "Давай сделаем наш тихий час традицией — память о нём согреет нас в любой день."
  ],
  "Безопасность и забота|Подарки": [
    "Я вижу твою нежность; каждый дар от меня — маленький щит, помнящий именно твою хрупкость.",
    "Этот небольшой талисман сохранит тепло нашей встречи — он никогда не станет обычным."
  ],
  "Безопасность и забота|Помощь": [
    "Я замечаю, когда тебе нужно опереться; моё дело — сделать шаг и сказать: «Я рядом».",
    "Позволь мне тихо решить то, что тревожит — и этот миг спокойствия останется с нами."
  ],
  "Безопасность и забота|Прикосновения": [
    "Я вижу, как твои плечи расслабляются от моего объятия; пусть оно всегда говорит без слов.",
    "Свяжем пальцы — этот жест станет паролем нашей близости и никогда не надоест."
  ],

  "Притяжение и страсть|Слова поддержки": [
    "Я слышу, как в твоём голосе пульсирует огонь; отвечаю словами, что разжигают нас двоих.",
    "Запишем эту искру в строку — пусть каждая буква вспыхивает, когда мы её читаем."
  ],
  "Притяжение и страсть|Время вместе": [
    "Твой взгляд зажигает смелость; украду часы, чтобы прожечь их рядом с тобой без остатка.",
    "Давай отмечать каждый рассвет вместе, чтобы огонь нашей встречи не угасал никогда."
  ],
  "Притяжение и страсть|Подарки": [
    "Дарю искру: символ нашего пламени, чтобы ты чувствовала, как страсть дышит даже в тишине.",
    "Пусть этот брелок вспыхнет воспоминанием, когда ты коснёшься его в кармане."
  ],
  "Притяжение и страсть|Помощь": [
    "Я вижу твою дерзость и подкладу плечо, когда пламя высоко — чтоб ты горела спокойно.",
    "Позволь мне зажечь свечи и убрать ветер — так момент страсти станет вечным."
  ],
  "Притяжение и страсть|Прикосновения": [
    "Твоё тело говорит огнём; моё прикосновение слушает его и отвечает тем же жаром.",
    "Запомним этот всплеск кожи: одно касание — и время обжигается навсегда."
  ],

  "Поддержка и признание|Слова поддержки": [
    "Я замечаю твою силу; словами поднимаю её выше, чтобы мир услышал твой настоящий голос.",
    "Сохраним этот комплимент как медаль, которую слышно только нам — и она не потускнеет."
  ],
  "Поддержка и признание|Время вместе": [
    "Я вижу, как ты растёшь; выделю часы, где твой триумф звучит, а я рядом, гордый тобой.",
    "Каждый успех отметим чаем в полночь — этот ритуал впечатает твои победы в память."
  ],
  "Поддержка и признание|Подарки": [
    "Дарю знак твоих свершений, чтобы ты знала: я вижу твою гордость и разделяю её.",
    "Пусть этот значок вспоминает о первом «ты смогла» каждый раз, когда ловит свет."
  ],
  "Поддержка и признание|Помощь": [
    "Я чувствую твой путь к вершине; подставлю плечо в тени, чтобы ты вышла к аплодисментам.",
    "Разберу преграды до сцены — и этот жест останется за кадром, но в твоём сердце."
  ],
  "Поддержка и признание|Прикосновения": [
    "Обниму так, чтобы ты услышала аплодисменты сквозь моё сердце — ты достойна их.",
    "Пусть щелчок наших ладоней перед стартом навсегда напомнит о твоей силе."
  ],

  "Забота и принятие|Слова поддержки": [
    "Я вижу твою нежную природу; слова мои — мягкий плед, разрешающий тебе быть любой.",
    "Оставим эту фразу, как листок между страниц — она пахнет нашей добротой."
  ],
  "Забота и принятие|Время вместе": [
    "Я чувствую твою уязвимость; проведу время, в котором ты можешь медлить и дышать спокойно.",
    "Назначим наши медленные воскресенья — и каждое станет тёплым следом в календаре."
  ],
  "Забота и принятие|Подарки": [
    "Дарю тебе маленькую чашку света, чтобы напомнить: тебя любят без условий и ожиданий.",
    "Этот брелок-сердце всегда отзывается, когда ты сомневаешься — и нежность оживает."
  ],
  "Забота и принятие|Помощь": [
    "Я вижу, когда твоя душа устала; тихо сделаю дела, чтобы ты выдохнула без стыда.",
    "Уберу лишний шум, и этот жест сохранит для нас минуту тишины в памяти."
  ],
  "Забота и принятие|Прикосновения": [
    "Моё лёгкое касание говорит: «Ты принята»; слушай его, когда слова кажутся лишними.",
    "Запомним плотность этого объятия — оно останется якорем в любое штормовое утро."
  ],

  "Общие смыслы и видение|Слова поддержки": [
    "Я слышу твои идеи; словами строю мост, чтобы мир увидел широту твоей мысли.",
    "Зафиксируем нашу мантру о будущем — пусть напоминает, куда мы движемся, когда всё шумит."
  ],
  "Общие смыслы и видение|Время вместе": [
    "Я вижу, как твой взгляд освещает горизонт; дарю тебе часы, где мы чертим общие карты.",
    "Каждый вторник делим мечты над чаем — этот ритуал навсегда начертит наш курс."
  ],
  "Общие смыслы и видение|Подарки": [
    "Принёс тебе карандаш будущего, чтобы твои идеи оставляли линии там, где их ждут.",
    "Этот маленький глобус пусть напоминает о точках, которые мы ещё свяжем вместе."
  ],
  "Общие смыслы и видение|Помощь": [
    "Я слышу широту твоих планов; возьму на себя детали, чтобы твоя мечта звучала громче.",
    "Подхвачу рутину, и этот жест оставит нам чистое небо для новых идей."
  ],
  "Общие смыслы и видение|Прикосновения": [
    "Когда я касаюсь твоей ладони, я ощущаю траекторию наших планет; держись, и мы летим.",
    "Пусть наш тайный знак в ладонях закрепит курс, куда бы ни занёс нас ветер."
  ],

  "Вдохновение и интуиция|Слова поддержки": [
    "Я слышу трепет твоих идей; моё слово — тихий ветер, который расправляет их крылья.",
    "Сохраним эту фразу-искру; она вспыхнет каждый раз, когда творчеству станет темно."
  ],
  "Вдохновение и интуиция|Время вместе": [
    "Я вижу, как твой взгляд ловит звёзды; дарю вечера, где мы разгадываем свет вместе.",
    "Учредим минуту созерцания на крыше — и каждая оставит на памяти отпечаток света."
  ],
  "Вдохновение и интуиция|Подарки": [
    "Дарю пустую страницу — холст твоей интуиции; пусть она знает, что я верю в её сюжет.",
    "Этот кристалл ловит лучи, чтобы каждый отблеск напомнил, как мысль рождает чудо."
  ],
  "Вдохновение и интуиция|Помощь": [
    "Я чувствую движение твоих идей; возьму на себя землю, чтобы ты могла парить выше.",
    "Освобожу твой календарь, и этот жест сохранит пространство для внезапных озарений."
  ],
  "Вдохновение и интуиция|Прикосновения": [
    "Лёгкое касание моих пальцев — это подсказка вселенной: твоя интуиция права.",
    "Запомним дрожь этой искры на коже — она навсегда свяжет мысль и чувство."
  ],

  "Тишина и слияние|Слова поддержки": [
    "Я слышу тишину между нашими словами; дам ей голос, который шепчет: «Мы — одно».",
    "Сохраним эту строку-пауза, чтобы даже молчание вспоминало нас."
  ],
  "Тишина и слияние|Время вместе": [
    "Я вижу бесконечность в наших паузах; подарю минуты, где время тает до чистого присутствия.",
    "Каждое новолуние сидим в тишине — и этот вакуум сохранит нас целыми."
  ],
  "Тишина и слияние|Подарки": [
    "Дарю гладкий камень из моря; его молчание напоминает, как глубоко наше безсловное единство.",
    "Пусть этот камень шепчет о нас, когда пальцы ищут остров тишины."
  ],
  "Тишина и слияние|Помощь": [
    "Я чувствую, когда шум давит; уберу лишнее, чтобы тишина снова объяла нас обоих.",
    "Очистим комнату от звуков — и этот жест останется в памяти чистым эхом."
  ],
  "Тишина и слияние|Прикосновения": [
    "Твоему сердцу достаточно одного молчаливого касания, чтобы вспомнить: мы уже соединены.",
    "Положу ладонь на твоё сердце — и этот жест сохранит абсолютную тишину внутри."
  ]
};

const chakraQualities: Record<string, string> = {
  "Безопасность и забота": "надёжность",
  "Притяжение и страсть": "пылающую смелость",
  "Поддержка и признание": "уверенность и силу",
  "Забота и принятие": "нежность",
  "Общие смыслы и видение": "глубину и мудрость",
  "Вдохновение и интуиция": "вдохновляющий свет",
  "Тишина и слияние": "спокойную тишину"
};

const langChannels: Record<string, string> = {
  "Слова поддержки": "слова",
  "Время вместе": "моменты",
  "Подарки": "знаки",
  "Помощь": "заботу",
  "Прикосновения": "прикосновения"
};

const chakraCTA: Record<string, string> = {
  "Безопасность и забота": "Сохрани свою любовь — пусть она всегда будет твоей тихой гаванью.",
  "Притяжение и страсть": "Зафиксируй пламя этого чувства — и пусть оно вспыхивает вновь, где бы вы ни были.",
  "Поддержка и признание": "Пусть ваша клятва станет символом силы, которую вы дарите друг другу.",
  "Забота и принятие": "Сохрани вашу нежность в блокчейне, как память о принятии и любви.",
  "Общие смыслы и видение": "Зафиксируй общее видение, чтобы всегда помнить, куда вы идёте вместе.",
  "Вдохновение и интуиция": "Сохрани эту искру вдохновения — как свидетельство вашей уникальной связи.",
  "Тишина и слияние": "Закрепи вашу тишину и слияние навсегда — как точку возвращения к любви."
};

const vowVerbs = ["хранить", "создавать", "защищать", "питать", "расти", "вдохновлять"];

function generateStructuredVow(data: string[]): { text: string[]; example: [string, string] } {
  const [myFeel, myLang, partnerFeel, partnerLang] = data;

  const q2 = chakraQualities[partnerFeel] || partnerFeel;
  const c2 = langChannels[partnerLang] || partnerLang;
  const q3 = chakraQualities[myFeel] || myFeel;
  const c3 = langChannels[myLang] || myLang;
  const verb = vowVerbs[Math.floor(Math.random() * vowVerbs.length)];
  const key = `${myFeel}|${myLang}`;
  const example = vowTemplates[key] || ["", ""];

  return {
    text: [
      "В этот момент, когда мир замер вокруг нас, я хочу сказать…",
      `Я вижу в тебе ${q2}, и через твои ${c2} чувствую, как моё сердце становится домом для тебя.`,
      `Из своей ${q3} я дарю тебе любовь через ${c3}, потому что именно так звучит моя душа рядом с тобой.`,
      `И я обещаю ${verb} пространство, где наши чувства будут расти сильнее каждого дня.`,
      "Я люблю тебя — сегодня, завтра и всегда."
    ],
    example
  };
}

const welcomeText =
  "Этот сервис поможет тебе выразить свою любовь и быть понятной именно твоей половинкой. Это серия из 4 вопросов настройки и списка рекомендаций.";

const startButtonText = "Начать";

const copyrightText =
  "Сервис бесплатный. Основан на разработках non profit R&D проекта Now You Can See love и запатентованой программе Чакроскоп.";

const questions = [
  {
    text: "Как ты чувствуешь любовь?",
    options: Object.keys(chakraQualities)
  },
  {
    text: "Как ты воспринимаешь любовь?",
    options: Object.keys(langChannels)
  },
  {
    text: "Как твоя половинка чувствует любовь?",
    options: Object.keys(chakraQualities)
  },
  {
    text: "Как она воспринимает любовь?",
    options: Object.keys(langChannels)
  }
];

export default function App() {
  const [step, setStep] = useState(-1);
  const [answers, setAnswers] = useState<string[]>([]);

  const handleOptionClick = (value: string) => {
    const newAnswers = [...answers];
    newAnswers[step] = value;
    setAnswers(newAnswers);
    setStep(step + 1);
  };

  const result = answers.length === 4 ? generateStructuredVow(answers) : null;
  const chakraCtaLine = chakraCTA[answers[0]] || "Сохрани эту вибрацию на блокчейне любви.";

  return (
    <div className="flex flex-col items-center justify-center min-h-screen px-4 py-8 text-center">
      {step === -1 ? (
        <>
          <p className="text-lg max-w-xl mb-6 leading-relaxed">{welcomeText}</p>
          <button
            onClick={() => setStep(0)}
            className="px-6 py-2 bg-black text-white rounded-full hover:bg-gray-800 transition"
          >
            {startButtonText}
          </button>
          <p className="mt-10 text-xs text-gray-500 max-w-xs">{copyrightText}</p>
        </>
      ) : step < questions.length ? (
        <div className="space-y-6 max-w-xl w-full">
          <h2 className="text-lg font-semibold mb-4">{questions[step].text}</h2>
          <div className="flex flex-wrap justify-center gap-2">
            {questions[step].options.map((text, idx) => (
              <button
                key={idx}
                onClick={() => handleOptionClick(text)}
                className="px-4 py-2 bg-white border rounded-full hover:bg-gray-100"
              >
                {text}
              </button>
            ))}
          </div>
        </div>
      ) : (
        <div className="text-gray-600 max-w-xl space-y-6">
          <h2 className="text-lg font-semibold">Твоя клятва любви</h2>
          {result?.text.map((line, idx) => (
            <p key={idx} className="text-base leading-relaxed">{line}</p>
          ))}
          {result?.example[0] && (
            <div className="mt-4 text-sm text-left">
              <p className="font-medium mb-1">Если ты хочешь усилить этот блок — можешь использовать что-то из этих фраз:</p>
              <p className="italic mb-2">“{result.example[0]}”</p>
              <p className="italic">“{result.example[1]}”</p>
            </div>
          )}
          <p className="text-sm text-gray-500 leading-relaxed">
            Твои клятвы — какими бы они ни были — говори от сердца, и они будут самыми правильными.<br />
            Мы создали сервис <a href="https://web3wed.io" target="_blank" className="underline">web3wed.io</a>, чтобы вы могли сохранить их навсегда. <b>{chakraCtaLine}</b>
          </p>
        </div>
      )}
    </div>
  );
}

