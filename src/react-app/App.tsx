import { useState } from "react";

// две строки на ключ: [0] — группа A, [1] — группа B
const vowTemplates: Record<string, [string, string]> = {
  "1|Слова поддержки": [
    "Я вижу твою хранимую теплоту и словами укрываю её, чтобы ты смело раскрылась рядом со мной.",
    "Сохраним наше чувство в этой фразе-обереге — пусть напоминает о доме даже через годы."
  ],
  "1|Время вместе": [
    "Я чувствую, как рядом с тобой я дышу глубже; подарю тебе время, где можешь быть настоящей.",
    "Давай сделаем наш тихий час традицией — память о нём согреет нас в любой день."
  ],
  "1|Подарки": [
    "Я вижу твою нежность; каждый дар от меня — маленький щит, помнящий именно твою хрупкость.",
    "Этот небольшой талисман сохранит тепло нашей встречи — он никогда не станет обычным."
  ],
  "1|Помощь": [
    "Я замечаю, когда тебе нужно опереться; моё дело — сделать шаг и сказать: «Я рядом».",
    "Позволь мне тихо решить то, что тревожит — и этот миг спокойствия останется с нами."
  ],
  "1|Прикосновения": [
    "Я вижу, как твои плечи расслабляются от моего объятия; пусть оно всегда говорит без слов.",
    "Свяжем пальцы — этот жест станет паролем нашей близости и никогда не надоест."
  ],

  "2|Слова поддержки": [
    "Я слышу, как в твоём голосе пульсирует огонь; отвечаю словами, что разжигают нас двоих.",
    "Запишем эту искру в строку — пусть каждая буква вспыхивает, когда мы её читаем."
  ],
  "2|Время вместе": [
    "Твой взгляд зажигает смелость; украду часы, чтобы прожечь их рядом с тобой без остатка.",
    "Давай отмечать каждый рассвет вместе, чтобы огонь нашей встречи не угасал никогда."
  ],
  "2|Подарки": [
    "Дарю искру: символ нашего пламени, чтобы ты чувствовала, как страсть дышит даже в тишине.",
    "Пусть этот брелок вспыхнет воспоминанием, когда ты коснёшься его в кармане."
  ],
  "2|Помощь": [
    "Я вижу твою дерзость и подкладу плечо, когда пламя высоко — чтоб ты горела спокойно.",
    "Позволь мне зажечь свечи и убрать ветер — так момент страсти станет вечным."
  ],
  "2|Прикосновения": [
    "Твоё тело говорит огнём; моё прикосновение слушает его и отвечает тем же жаром.",
    "Запомним этот всплеск кожи: одно касание — и время обжигается навсегда."
  ],

  "3|Слова поддержки": [
    "Я замечаю твою силу; словами поднимаю её выше, чтобы мир услышал твой настоящий голос.",
    "Сохраним этот комплимент как медаль, которую слышно только нам — и она не потускнеет."
  ],
  "3|Время вместе": [
    "Я вижу, как ты растёшь; выделю часы, где твой триумф звучит, а я рядом, гордый тобой.",
    "Каждый успех отметим чаем в полночь — этот ритуал впечатает твои победы в память."
  ],
  "3|Подарки": [
    "Дарю знак твоих свершений, чтобы ты знала: я вижу твою гордость и разделяю её.",
    "Пусть этот значок вспоминает о первом «ты смогла» каждый раз, когда ловит свет."
  ],
  "3|Помощь": [
    "Я чувствую твой путь к вершине; подставлю плечо в тени, чтобы ты вышла к аплодисментам.",
    "Разберу преграды до сцены — и этот жест останется за кадром, но в твоём сердце."
  ],
  "3|Прикосновения": [
    "Обниму так, чтобы ты услышала аплодисменты сквозь моё сердце — ты достойна их.",
    "Пусть щелчок наших ладоней перед стартом навсегда напомнит о твоей силе."
  ],

  "4|Слова поддержки": [
    "Я вижу твою нежную природу; слова мои — мягкий плед, разрешающий тебе быть любой.",
    "Оставим эту фразу, как листок между страниц — она пахнет нашей добротой."
  ],
  "4|Время вместе": [
    "Я чувствую твою уязвимость; проведу время, в котором ты можешь медлить и дышать спокойно.",
    "Назначим наши медленные воскресенья — и каждое станет тёплым следом в календаре."
  ],
  "4|Подарки": [
    "Дарю тебе маленькую чашку света, чтобы напомнить: тебя любят без условий и ожиданий.",
    "Этот брелок-сердце всегда отзывается, когда ты сомневаешься — и нежность оживает."
  ],
  "4|Помощь": [
    "Я вижу, когда твоя душа устала; тихо сделаю дела, чтобы ты выдохнула без стыда.",
    "Уберу лишний шум, и этот жест сохранит для нас минуту тишины в памяти."
  ],
  "4|Прикосновения": [
    "Моё лёгкое касание говорит: «Ты принята»; слушай его, когда слова кажутся лишними.",
    "Запомним плотность этого объятия — оно останется якорем в любое штормовое утро."
  ],

  "5|Слова поддержки": [
    "Я слышу твои идеи; словами строю мост, чтобы мир увидел широту твоей мысли.",
    "Зафиксируем нашу мантру о будущем — пусть напоминает, куда мы движемся, когда всё шумит."
  ],
  "5|Время вместе": [
    "Я вижу, как твой взгляд освещает горизонт; дарю тебе часы, где мы чертим общие карты.",
    "Каждый вторник делим мечты над чаем — этот ритуал навсегда начертит наш курс."
  ],
  "5|Подарки": [
    "Принёс тебе карандаш будущего, чтобы твои идеи оставляли линии там, где их ждут.",
    "Этот маленький глобус пусть напоминает о точках, которые мы ещё свяжем вместе."
  ],
  "5|Помощь": [
    "Я слышу широту твоих планов; возьму на себя детали, чтобы твоя мечта звучала громче.",
    "Подхвачу рутину, и этот жест оставит нам чистое небо для новых идей."
  ],
  "5|Прикосновения": [
    "Когда я касаюсь твоей ладони, я ощущаю траекторию наших планет; держись, и мы летим.",
    "Пусть наш тайный знак в ладонях закрепит курс, куда бы ни занёс нас ветер."
  ],

  "6|Слова поддержки": [
    "Я слышу трепет твоих идей; моё слово — тихий ветер, который расправляет их крылья.",
    "Сохраним эту фразу-искру; она вспыхнет каждый раз, когда творчеству станет темно."
  ],
  "6|Время вместе": [
    "Я вижу, как твой взгляд ловит звёзды; дарю вечера, где мы разгадываем свет вместе.",
    "Учредим минуту созерцания на крыше — и каждая оставит на памяти отпечаток света."
  ],
  "6|Подарки": [
    "Дарю пустую страницу — холст твоей интуиции; пусть она знает, что я верю в её сюжет.",
    "Этот кристалл ловит лучи, чтобы каждый отблеск напомнил, как мысль рождает чудо."
  ],
  "6|Помощь": [
    "Я чувствую движение твоих идей; возьму на себя землю, чтобы ты могла парить выше.",
    "Освобожу твой календарь, и этот жест сохранит пространство для внезапных озарений."
  ],
  "6|Прикосновения": [
    "Лёгкое касание моих пальцев — это подсказка вселенной: твоя интуиция права.",
    "Запомним дрожь этой искры на коже — она навсегда свяжет мысль и чувство."
  ],

  "7|Слова поддержки": [
    "Я слышу тишину между нашими словами; дам ей голос, который шепчет: «Мы — одно».",
    "Сохраним эту строку-пауза, чтобы даже молчание вспоминало нас."
  ],
  "7|Время вместе": [
    "Я вижу бесконечность в наших паузах; подарю минуты, где время тает до чистого присутствия.",
    "Каждое новолуние сидим в тишине — и этот вакуум сохранит нас целыми."
  ],
  "7|Подарки": [
    "Дарю гладкий камень из моря; его молчание напоминает, как глубоко наше безсловное единство.",
    "Пусть этот камень шепчет о нас, когда пальцы ищут остров тишины."
  ],
  "7|Помощь": [
    "Я чувствую, когда шум давит; уберу лишнее, чтобы тишина снова объяла нас обоих.",
    "Очистим комнату от звуков — и этот жест останется в памяти чистым эхом."
  ],
  "7|Прикосновения": [
    "Твоему сердцу достаточно одного молчаливого касания, чтобы вспомнить: мы уже соединены.",
    "Положу ладонь на твоё сердце — и этот жест сохранит абсолютную тишину внутри."
  ]
};


const chakraQualities: Record<string, string> = {
  "1": "надёжность",
  "2": "пылающую смелость",
  "3": "уверенность и силу",
  "4": "нежность",
  "5": "глубину и мудрость",
  "6": "вдохновляющий свет",
  "7": "спокойную тишину"
};

const langChannels: Record<string, string> = {
  "Слова поддержки": "слова",
  "Время вместе": "моменты",
  "Подарки": "знаки",
  "Помощь": "заботу",
  "Прикосновения": "прикосновения"
};

const chakraCTA: Record<string, string> = {
  "1": "Сохрани свою любовь — пусть она всегда будет твоей тихой гаванью.",
  "2": "Зафиксируй пламя этого чувства — и пусть оно вспыхивает вновь, где бы вы ни были.",
  "3": "Пусть ваша клятва станет символом силы, которую вы дарите друг другу.",
  "4": "Сохрани вашу нежность в блокчейне, как память о принятии и любви.",
  "5": "Зафиксируй общее видение, чтобы всегда помнить, куда вы идёте вместе.",
  "6": "Сохрани эту искру вдохновения — как свидетельство вашей уникальной связи.",
  "7": "Закрепи вашу тишину и слияние навсегда — как точку возвращения к любви."
};

const seeingVerb: Record<string, string> = {
  "1": "замечаю",
  "2": "вижу",
  "3": "наблюдаю",
  "4": "чувствую",
  "5": "считываю",
  "6": "ощущаю",
  "7": "вслушиваюсь"
};

const soulVerb: Record<string, string> = {
  "1": "покоится",
  "2": "вспыхивает",
  "3": "укрепляется",
  "4": "мягко раскрывается",
  "5": "отражается",
  "6": "поёт",
  "7": "затихает"
};

const buildVerb: Record<string, string> = {
  "1": "сохранять",
  "2": "разжигать",
  "3": "укреплять",
  "4": "оберегать",
  "5": "направлять",
  "6": "вдохновлять",
  "7": "собирать в тишине"
};

const spaceImage: Record<string, string> = {
  "1": "остров спокойствия",
  "2": "вспышка чувств",
  "3": "надёжная опора",
  "4": "уютное пространство",
  "5": "пространство замысла",
  "6": "звучащее пространство",
  "7": "молчаливое присутствие"
};

const growthVerb: Record<string, string> = {
  "Слова поддержки": "прорастать",
  "Время вместе": "укрепляться",
  "Подарки": "накапливаться",
  "Помощь": "раскрываться",
  "Прикосновения": "оживать"
};

const imagePhrase: Record<string, string> = {
  "1": "домом, где спокойно",
  "2": "огнём, который зовёт",
  "3": "опорой, в которую верят",
  "4": "теплом, к которому хочется возвращаться",
  "5": "местом, где оживают смыслы",
  "6": "пространством, где рождаются идеи",
  "7": "тишиной, где всё сливается в одно"
};
function generateStructuredVow(data: string[]): {
  text: [string, React.ReactNode][];
  selfExample?: [string, string];
  partnerExample?: [string, string];
} {
  const [myFeel, myLang, partnerFeel, partnerLang] = data;

  const q2 = chakraQualities[partnerFeel] || partnerFeel;
  const c2 = langChannels[partnerLang] || partnerLang;
  const q3 = chakraQualities[myFeel] || myFeel;
  const c3 = langChannels[myLang] || myLang;

  const see = seeingVerb[partnerFeel];
  const imageDetail = imagePhrase[partnerFeel];
  const soul = soulVerb[myFeel];
  const verb = buildVerb[myFeel];
  const space = spaceImage[myFeel];
  const grow = growthVerb[myLang];

  const selfKey = `${myFeel}|${myLang}`;
  const partnerKey = `${partnerFeel}|${partnerLang}`;

  return {
    text: [
      ["📍 Открытие", <>В этот момент, когда мир замер вокруг нас, я хочу сказать…</>],
      ["💬 О нём", <>
        Я <i>{see}</i> в тебе <i>{q2}</i>, и через твои <i>{c2}</i> чувствую,
        как моё сердце становится <i>{imageDetail}</i>.
      </>],
      ["🫶 О себе", <>
        Из своей <i>{q3}</i> я дарю тебе любовь через <i>{c3}</i>, потому что именно так <i>{soul}</i> моя душа рядом с тобой.
      </>],
      ["🤝 Обещание", <>
        И я обещаю <i>{verb}</i> <i>{space}</i>, где наши чувства будут <i>{grow}</i> с каждым днём.
      </>],
      ["❤️ Финал", <>Я люблю тебя — сегодня, завтра и всегда.</>]
    ],
    selfExample: vowTemplates[selfKey],
    partnerExample: vowTemplates[partnerKey]
  };
}

const welcomeText =
  "Этот сервис поможет тебе выразить свою любовь и быть понятной именно твоей половинкой. Это серия из 4 вопросов настройки и списка рекомендаций.";

const startButtonText = "Начать";

const copyrightText =
  "Сервис бесплатный. Основан на разработках non profit R&D проекта Now You Can See love и запатентованой программе Чакроскоп.";

const chakraOptions = [
  { id: "1", label: "Безопасность и забота" },
  { id: "2", label: "Притяжение и страсть" },
  { id: "3", label: "Поддержка и признание" },
  { id: "4", label: "Забота и принятие" },
  { id: "5", label: "Общие смыслы и видение" },
  { id: "6", label: "Вдохновение и интуиция" },
  { id: "7", label: "Тишина и слияние" }
];

const langOptions = Object.entries(langChannels).map(([id, label]) => ({ id, label }));

const questions = [
  {
    text: "Как ты чувствуешь любовь?",
    options: chakraOptions
  },
  {
    text: "Как ты воспринимаешь любовь?",
    options: langOptions
  },
  {
    text: "Как твоя половинка чувствует любовь?",
    options: chakraOptions
  },
  {
    text: "Как она воспринимает любовь?",
    options: langOptions
  }
];

export default function App() {
  const [step, setStep] = useState(-1);
  const [answers, setAnswers] = useState<string[]>([]);

  const handleOptionClick = (value: string) => {
    const newAnswers = [...answers];
    newAnswers[step] = value;
    setAnswers(newAnswers);
    setStep(step + 1);
  };

  const result = answers.length === 4 ? generateStructuredVow(answers) : null;
  const chakraCtaLine = chakraCTA[answers[0]] || "Сохрани эту вибрацию на блокчейне любви.";

  return (
    <div style={{ fontFamily: "'EB Garamond', serif", backgroundColor: "white", color: "#222", padding: "2rem", maxWidth: "640px", margin: "0 auto", textAlign: "center" as const }}>
      {step === -1 ? (
        <>
          <p style={{ fontSize: "1.1rem", lineHeight: "1.6" }}>{welcomeText}</p>
          <button style={{ padding: "0.5rem 1.2rem", background: "black", color: "white", borderRadius: "999px", border: "none", cursor: "pointer", marginTop: "1rem" }} onClick={() => setStep(0)}>
            {startButtonText}
          </button>
          <p style={{ fontSize: "0.8rem", color: "#666", marginTop: "2rem" }}>{copyrightText}</p>
        </>
      ) : step < questions.length ? (
        <div>
          <h2 style={{ fontWeight: "bold", fontSize: "1.2rem", marginBottom: "1rem" }}>{questions[step].text}</h2>
          <div style={{ display: "flex", flexWrap: "wrap", gap: "0.5rem", justifyContent: "center" }}>
            {questions[step].options.map(({ id, label }) => (
              <button
                key={id}
                style={{ padding: "0.5rem 1.2rem", background: "#eee", color: "#000", borderRadius: "999px", border: "none", cursor: "pointer" }}
                onClick={() => handleOptionClick(id)}
              >
                {label}
              </button>
            ))}
          </div>
        </div>
      ) : (
        <div style={{ marginTop: "1.5rem" }}>
          <h2 style={{ fontWeight: "bold", fontSize: "1.4rem", marginBottom: "1.5rem" }}>Твоя клятва любви</h2>
          {result?.text.map(([label, jsx], idx) => {
            const showHint = idx === 1 || idx === 2;
            const hintLeft = idx === 1 ? "сказать личное и важное о его" : "сказать от сердца о себе";
            const hintRight = idx === 1 ? "привести пример про" : "показать свой способ любви";

            return (
              <div key={idx} style={{ display: "flex", gap: "2rem", alignItems: "flex-start", marginBottom: "2.5rem" }}>
                <div style={{ flex: 1, fontFamily: "Helvetica, sans-serif", fontSize: "0.75rem", color: "#888", lineHeight: 1.4 }}>
                  <div style={{ marginBottom: "0.5rem" }}>{label}</div>
                  {showHint && (
                    <>
                      <div style={{ marginBottom: "0.3rem" }}>{hintLeft}</div>
                      <div>{hintRight}</div>
                    </>
                  )}
                </div>
                <div style={{ flex: 3 }}>
                  <p style={{ fontSize: "1.6rem", lineHeight: "1.6", fontWeight: 400 }}>{jsx}</p>
                  {idx === 1 && result?.partnerExample && (
                    <div style={{ marginTop: "1rem" }}>
                      <div style={{ fontSize: "0.8rem", marginBottom: "0.4rem", fontFamily: "Helvetica, sans-serif", color: "#444" }}>
                        Если ты хочешь усилить блок «О нём» — можешь использовать что-то из этих фраз:
                      </div>
                      <p style={{ fontStyle: "italic", marginBottom: "0.4rem" }}>“{result.partnerExample[0]}”</p>
                      <p style={{ fontStyle: "italic" }}>“{result.partnerExample[1]}”</p>
                    </div>
                  )}
                  {idx === 2 && result?.selfExample && (
                    <div style={{ marginTop: "1rem" }}>
                      <div style={{ fontSize: "0.8rem", marginBottom: "0.4rem", fontFamily: "Helvetica, sans-serif", color: "#444" }}>
                        Если ты хочешь усилить блок «О себе» — можешь использовать что-то из этих фраз:
                      </div>
                      <p style={{ fontStyle: "italic", marginBottom: "0.4rem" }}>“{result.selfExample[0]}”</p>
                      <p style={{ fontStyle: "italic" }}>“{result.selfExample[1]}”</p>
                    </div>
                  )}
                </div>
              </div>
            );
          })}

          <div style={{ borderTop: "1px solid #ccc", paddingTop: "1.5rem", fontSize: "0.9rem", color: "#444" }}>
            <p style={{ lineHeight: "1.5" }}>
              Твои клятвы — какими бы они ни были — говори от сердца, и они будут самыми правильными.<br />
              Мы создали сервис <a href="https://web3wed.io" target="_blank" style={{ color: "#000", textDecoration: "underline" }}>web3wed.io</a>, чтобы вы могли сохранить их навсегда. <b>{chakraCtaLine}</b>
            </p>
          </div>
        </div>
      )}
    </div>
  );
}
